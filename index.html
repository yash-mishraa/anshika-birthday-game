<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Birthday Anshika!</title>
    <style>
        /* Imported: Fredoka (Game), Pacifico (Headings), Press Start 2P (Timer), Special Elite (Suspense) */
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Pacifico&family=Press+Start+2P&family=Special+Elite&display=swap');

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #333;
            font-family: 'Fredoka One', cursive;
            touch-action: none; /* Prevent scrolling on mobile */
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            /* Fallback gradient if JS fails */
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF); 
        }

        /* --- LOCK SCREEN STYLES --- */
        #lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000000; /* Full Black Dark */
            z-index: 5000; /* Highest priority */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            transition: opacity 1s ease-out;
        }

        #lock-message {
            font-family: 'Special Elite', cursive; /* Suspicious Typewriter Font */
            font-size: 2rem;
            color: #ffffff;
            margin-bottom: 40px;
            letter-spacing: 1px;
            text-align: center;
            padding: 0 20px;
            opacity: 0.9;
        }

        #timer {
            font-family: 'Press Start 2P', cursive; /* Minecraft/Pixel Font */
            font-size: 1.8rem; /* Adjusted for pixel font width */
            color: #00ff00; /* Retro bright green for contrast */
            text-shadow: 4px 4px 0px #003300; /* 3D Pixel shadow */
            line-height: 1.5;
            text-align: center;
            margin-top: 20px;
        }

        /* Overlay for UI messages */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            z-index: 100;
        }

        /* Birthday Video Styling */
        #birthday-video {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed ensures it covers viewport on mobile */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            /* 'contain' ensures the whole video is seen without cropping */
            object-fit: contain; 
            z-index: 200;
            background-color: black; /* Black bars for fitting */
        }

        /* Loading Spinner for Video */
        #video-loader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 250;
            color: white;
            font-size: 1.5rem;
            text-align: center;
        }

        /* Replay Button (appears over video) */
        #replay-btn {
            display: none;
            position: fixed; /* Changed to fixed to stay on top of video */
            bottom: 50px; /* Position from bottom */
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 40px; /* Larger touch target */
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            background-color: #ff4081;
            color: white;
            border: 4px solid white;
            border-radius: 50px;
            cursor: pointer;
            z-index: 1000; /* Super high z-index */
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            pointer-events: auto; /* Enable clicking */
            -webkit-tap-highlight-color: transparent;
        }
        #replay-btn:active {
            transform: translateX(-50%) scale(0.95);
            background-color: #f50057;
        }

        h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3rem;
            color: #ff4081;
            margin: 0;
            padding: 10px;
            animation: float 3s ease-in-out infinite;
        }

        p {
            font-size: 1.5rem;
            color: white;
            margin: 10px;
        }

        .score-display {
            position: absolute;
            top: 10%;
            font-size: 4rem;
            color: white;
            z-index: 10;
        }

        .best-score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5rem;
            color: #FFD700; /* Gold color */
            z-index: 10;
            text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            h1 { font-size: 2.5rem; }
            p { font-size: 1.2rem; }
            .best-score-display { font-size: 1.2rem; }
            #timer { font-size: 1.2rem; line-height: 2; } /* Smaller timer on mobile to fit screen */
            #lock-message { font-size: 1.2rem; margin-bottom: 30px; }
        }
    </style>
</head>
<body>

    <!-- LOCK SCREEN -->
    <div id="lock-screen">
        <div id="lock-message">SOMETHING SPECIAL AWAITS...</div>
        <div id="timer">00d 00h 00m 00s</div>
    </div>

    <!-- Persistent Background Music -->
    <!-- Added id, preload, and autoplay to try forcing audio on load -->
    <audio id="bgm" src="anshika.mp3" loop preload="auto" autoplay></audio>
    
    <!-- Crash Sound (Obstacle) -->
    <audio id="crash-sound" src="obstacle.mp3" preload="auto"></audio>

    <!-- Video Element -->
    <!-- Added preload="auto" to help with lag -->
    <video id="birthday-video" src="anshikaaa.mp4" playsinline webkit-playsinline preload="auto"></video>
    <div id="video-loader">Loading Video...</div>
    
    <div id="replay-btn">Play Again</div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="best-score-display">Best: <span id="best-score-val">0</span></div>
        
        <div id="start-screen">
            <h1>Happy Birthday Anshika!</h1>
            <p>Tap to Start</p>
        </div>
        
        <div class="score-display" id="score-counter">0</div>
    </div>

    <script>
        // --- Configuration & Assets ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score-counter');
        const bestScoreEl = document.getElementById('best-score-val');
        const startScreen = document.getElementById('start-screen');
        const replayBtn = document.getElementById('replay-btn');
        const birthdayVideo = document.getElementById('birthday-video');
        const videoLoader = document.getElementById('video-loader');
        const bgm = document.getElementById('bgm');
        const crashSound = document.getElementById('crash-sound');
        
        // Lock Screen Elements
        const lockScreen = document.getElementById('lock-screen');
        const timerEl = document.getElementById('timer');

        // --- VOLUME SETTINGS ---
        bgm.volume = 0.6; 
        crashSound.volume = 1.0; 

        const birdImageSource = "anshika.jpg";
        const birdImg = new Image();
        birdImg.src = birdImageSource;
        birdImg.onerror = () => { console.log("Image failed to load:", birdImageSource); };

        let gameState = 'LOCKED'; // Start as LOCKED
        let frames = 0;
        let score = 0;
        let bestScore = localStorage.getItem('anshika_flappy_best') || 0;
        bestScoreEl.innerText = bestScore;

        let speed = 2.5; 
        let gravity = 0.25;
        let jumpStrength = 6.5; 
        let loopId = null; 
        let isAudioUnlocked = false; 

        // --- TIMER LOGIC ---
        // Target Date: December 22, 2025 at 00:00:00 IST
        // IST is UTC +5:30
        const targetDate = new Date("2025-12-22T00:00:00+05:30").getTime();

        function updateTimer() {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                // Unlock
                unlockSite();
                return;
            }

            // Calculations
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Formatting with leading zeros
            const d = days < 10 ? "0" + days : days;
            const h = hours < 10 ? "0" + hours : hours;
            const m = minutes < 10 ? "0" + minutes : minutes;
            const s = seconds < 10 ? "0" + seconds : seconds;

            // Timer Display Format
            // Adding line breaks for mobile readability if needed, or keeping one line
            if(window.innerWidth < 600) {
                // Stack on mobile
                timerEl.innerHTML = `${d}D ${h}H<br>${m}M ${s}S`;
            } else {
                timerEl.innerText = `${d}D ${h}H ${m}M ${s}S`;
            }
        }

        function unlockSite() {
            // If already unlocked, do nothing
            if (gameState !== 'LOCKED') return;

            // Fade out lock screen
            lockScreen.style.opacity = '0';
            setTimeout(() => {
                lockScreen.style.display = 'none';
            }, 1000);

            // Change state to allow game start
            gameState = 'START';
            
            // Try to autoplay music if unlocked naturally
            var promise = bgm.play();
            if(promise !== undefined) {
                promise.catch(e => { /* Autoplay blocked, wait for tap */ });
            }
        }

        // Run timer every second
        const timerInterval = setInterval(updateTimer, 1000);
        // Run once immediately
        updateTimer();


        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ground.y = canvas.height - 50; 
            updateTimer(); // Force update on resize to fix layout
        }
        window.addEventListener('resize', resize);

        // --- Game Objects ---
        const bgColors = [
            ['#FFDEE9', '#B5FFFC'], ['#D4FC79', '#96E6A1'], 
            ['#FDC830', '#F37335'], ['#E0C3FC', '#8EC5FC']
        ];
        let currentBgIndex = 0;

        const confetti = [];
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height - canvas.height;
                this.size = Math.random() * 8 + 4;
                this.speedY = Math.random() * 2 + 1;
                this.speedX = Math.random() * 2 - 1;
                this.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = Math.random() * 5 - 2.5;
            }
            update() {
                this.y += this.speedY;
                this.x += this.speedX;
                this.rotation += this.rotationSpeed;
                if (this.y > canvas.height) {
                    this.y = -10;
                    this.x = Math.random() * canvas.width;
                }
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation * Math.PI / 180);
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                ctx.restore();
            }
        }
        for(let i=0; i<50; i++) confetti.push(new Particle());

        const bird = {
            x: 50, y: 150, w: 54, h: 54, velocity: 0, radius: 27, rotation: 0,
            draw: function() {
                if (this.velocity < 0) this.rotation = -25 * Math.PI / 180;
                else if (this.velocity > 0) {
                    this.rotation += 2 * Math.PI / 180;
                    if(this.rotation > 90 * Math.PI / 180) this.rotation = 90 * Math.PI / 180;
                } else {
                    this.rotation = 0;
                }
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                if (birdImg.complete && birdImg.naturalWidth !== 0) {
                    const aspect = birdImg.width / birdImg.height;
                    let drawW = this.w; let drawH = this.h;
                    if(aspect > 1) drawH = drawW / aspect; else drawW = drawH * aspect;
                    ctx.drawImage(birdImg, -this.w/2, -this.h/2, this.w, this.h);
                } else {
                    ctx.fillStyle = '#FFD700'; ctx.fillRect(-this.w/2, -this.h/2, this.w, this.h);
                }
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 3; ctx.stroke();
                ctx.restore();
            },
            jump: function() { this.velocity = -jumpStrength; },
            update: function() {
                this.velocity += gravity; this.y += this.velocity;
                if (this.y + this.radius >= ground.y) { this.y = ground.y - this.radius; gameOver(); }
                if (this.y - this.radius <= 0) { this.y = 0 + this.radius; this.velocity = 0; }
            },
            reset: function() {
                this.x = canvas.width * 0.2; this.y = canvas.height / 2;
                this.velocity = 0; this.rotation = 0;
            }
        };

        const pipes = {
            items: [], w: 50, gap: 220, dx: 2.5,
            draw: function() {
                for (let i = 0; i < this.items.length; i++) {
                    let p = this.items[i];
                    this.drawCandle(p.x, 0, this.w, p.top, true); 
                    this.drawCandle(p.x, canvas.height - p.bottom, this.w, p.bottom, false);
                }
            },
            drawCandle: function(x, y, w, h, isTop) {
                ctx.fillStyle = '#FFC0CB'; ctx.fillRect(x, y, w, h);
                ctx.fillStyle = '#FF69B4'; ctx.beginPath();
                for(let i = 0; i < h; i+=20) ctx.fillRect(x, y + i, w, 10);
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.strokeRect(x, y, w, h);
                let flameY = isTop ? y + h : y;
                ctx.fillStyle = '#FFF'; ctx.fillRect(x - 5, flameY - 5, w + 10, 10);
            },
            update: function() {
                if (frames % 120 === 0) {
                    let availableHeight = ground.y - this.gap;
                    let topHeight = Math.random() * (availableHeight - 100) + 50;
                    let bottomHeight = availableHeight - topHeight;
                    this.items.push({ x: canvas.width, top: topHeight, bottom: bottomHeight, passed: false });
                }
                for (let i = 0; i < this.items.length; i++) {
                    let p = this.items[i];
                    p.x -= this.dx;
                    if (bird.x + bird.radius - 5 > p.x && bird.x - bird.radius + 5 < p.x + this.w && bird.y - bird.radius + 5 < p.top) gameOver();
                    if (bird.x + bird.radius - 5 > p.x && bird.x - bird.radius + 5 < p.x + this.w && bird.y + bird.radius - 5 > canvas.height - p.bottom) gameOver();
                    if (p.x + this.w < bird.x && !p.passed) {
                        score++; scoreEl.innerText = score; p.passed = true;
                        if(score % 5 === 0) this.dx += 0.1;
                    }
                    if (p.x + this.w < 0) { this.items.shift(); i--; }
                }
            },
            reset: function() { this.items = []; this.dx = speed; }
        };

        const ground = {
            y: 0,
            draw: function() {
                ctx.fillStyle = '#8BC34A'; ctx.fillRect(0, this.y, canvas.width, canvas.height - this.y);
                ctx.strokeStyle = '#689F38'; ctx.beginPath(); ctx.moveTo(0, this.y); ctx.lineTo(canvas.width, this.y); ctx.stroke();
            }
        };

        function init() { 
            resize(); 
            bird.reset(); 
            scoreEl.style.display = 'none'; 
            loop(); 

            // Initial state check for lock
            const now = new Date().getTime();
            if (now >= targetDate) {
                 unlockSite();
            } else {
                // Keep it locked
                gameState = 'LOCKED';
            }
        }

        function startGame() {
            if (gameState === 'LOCKED') return; // Do not start if locked
            if (gameState === 'PLAYING') return;
            gameState = 'PLAYING';
            
            // Hide video elements
            birthdayVideo.style.display = 'none'; 
            birthdayVideo.pause(); 
            birthdayVideo.currentTime = 0; 
            videoLoader.style.display = 'none';
            replayBtn.style.display = 'none';
            
            // Show Game Canvas
            canvas.style.display = 'block';

            score = 0; scoreEl.innerText = score;
            startScreen.style.display = 'none'; scoreEl.style.display = 'block';
            
            currentBgIndex = Math.floor(Math.random() * bgColors.length);
            bird.reset(); pipes.reset(); frames = 0; bird.jump();
            
            if(!loopId) loop(); 
        }

        function gameOver() {
            if(gameState === 'GAMEOVER') return;
            gameState = 'GAMEOVER';
            scoreEl.style.display = 'none';
            
            // Play crash sound
            crashSound.currentTime = 0;
            crashSound.volume = 1.0; 
            crashSound.play().catch(e => console.log("Crash sound error:", e));

            if(score > bestScore) {
                bestScore = score; localStorage.setItem('anshika_flappy_best', bestScore); bestScoreEl.innerText = bestScore;
            }
            
            // VIDEO HANDLING
            videoLoader.style.display = 'block';
            birthdayVideo.style.display = 'block';
            canvas.style.display = 'none';
            
            if(loopId) {
                cancelAnimationFrame(loopId);
                loopId = null;
            }

            birthdayVideo.muted = false; 
            var playPromise = birthdayVideo.play();
            
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    videoLoader.style.display = 'none';
                })
                .catch(error => {
                    console.log("Video play error:", error);
                    videoLoader.style.display = 'none';
                });
            }
            
            setTimeout(() => { 
                replayBtn.style.display = 'block'; 
            }, 2000);
        }

        function update() {
            confetti.forEach(p => p.update());
            if (gameState === 'PLAYING') { bird.update(); pipes.update(); frames++; }
            else if (gameState === 'GAMEOVER') {
                if(bird.y + bird.radius < ground.y) { bird.y += 10; bird.rotation += 10 * Math.PI / 180; }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            grad.addColorStop(0, bgColors[currentBgIndex][0]); grad.addColorStop(1, bgColors[currentBgIndex][1]);
            ctx.fillStyle = grad; ctx.fillRect(0, 0, canvas.width, canvas.height);
            confetti.forEach(p => p.draw());
            pipes.draw(); ground.draw(); bird.draw();
        }

        function loop() { 
            update(); 
            draw(); 
            loopId = requestAnimationFrame(loop); 
        }

        function unlockAudio() {
            if(isAudioUnlocked) return;
            isAudioUnlocked = true;
            
            bgm.play().then(() => {
                console.log("Audio unlocked successfully");
            }).catch(e => console.log("Audio unlock failed", e));

            crashSound.play().then(() => { crashSound.pause(); crashSound.currentTime=0; }).catch(()=>{});
            birthdayVideo.play().then(() => { birthdayVideo.pause(); birthdayVideo.currentTime=0; }).catch(()=>{});
        }

        function handleInput(e) {
            if (gameState === 'LOCKED') return; // No input if locked

            if (e.target === replayBtn) return;
            if (e.type === 'touchstart') e.preventDefault();
            
            unlockAudio();

            if (gameState === 'START') {
                startGame();
            } else if (gameState === 'PLAYING') {
                bird.jump();
            }
        }

        function handleReplay(e) {
            e.stopPropagation();
            e.preventDefault();
            unlockAudio(); 
            startGame();
        }
        
        replayBtn.addEventListener('touchend', handleReplay);
        replayBtn.addEventListener('click', handleReplay);

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if(gameState === 'GAMEOVER' && replayBtn.style.display === 'block') {
                    handleReplay(e);
                } else {
                    handleInput(e);
                }
            }
        });
        
        window.addEventListener('mousedown', (e) => {
             if(e.target !== replayBtn) handleInput(e);
        });
        
        window.addEventListener('touchstart', handleInput, {passive: false});
        
        window.addEventListener('touchstart', function() {
            if (bgm.paused && gameState !== 'LOCKED') {
                unlockAudio();
            }
        }, { once: true });

        init();
    </script>
</body>
</html>